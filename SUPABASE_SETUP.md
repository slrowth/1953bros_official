# Supabase ì—°ë™ ì„¤ì • ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” 1953í˜•ì œë¼ì§€êµ­ë°¥ í”„ëœì°¨ì´ì¦ˆ í”Œë«í¼ì— Supabaseë¥¼ ì—°ë™í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [Supabase í”„ë¡œì íŠ¸ ìƒì„±](#1-supabase-í”„ë¡œì íŠ¸-ìƒì„±)
2. [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#2-í™˜ê²½-ë³€ìˆ˜-ì„¤ì •)
3. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì ìš©](#3-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ-ì ìš©)
4. [ì¸ì¦ ì„¤ì •](#4-ì¸ì¦-ì„¤ì •)
5. [RLS ì •ì±… ì„¤ì •](#5-rls-ì •ì±…-ì„¤ì •)
6. [í…ŒìŠ¤íŠ¸](#6-í…ŒìŠ¤íŠ¸)

---

## 1. Supabase í”„ë¡œì íŠ¸ ìƒì„±

### 1.1 Supabase ê³„ì • ìƒì„± ë° í”„ë¡œì íŠ¸ ìƒì„±

1. [Supabase](https://supabase.com)ì— ì ‘ì†í•˜ì—¬ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.
2. "New Project" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
3. í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤:
   - **Name**: í”„ë¡œì íŠ¸ ì´ë¦„ (ì˜ˆ: `1953-franchise-platform`)
   - **Database Password**: ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ë°˜ë“œì‹œ ì €ì¥í•´ë‘ì„¸ìš”)
   - **Region**: ê°€ì¥ ê°€ê¹Œìš´ ë¦¬ì „ ì„ íƒ (ì˜ˆ: `Northeast Asia (Seoul)`)

### 1.2 í”„ë¡œì íŠ¸ ì„¤ì • í™•ì¸

í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ë©´ ë‹¤ìŒ ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤:
- **Project URL**: `https://xxxxx.supabase.co`
- **API Keys**: Settings > APIì—ì„œ í™•ì¸ ê°€ëŠ¥

---

## 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### 2.1 `.env.local` íŒŒì¼ ìƒì„±

í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— `.env.local` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•©ë‹ˆë‹¤:

```env
# Supabase ì„¤ì •
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# ì„œë²„ ì‚¬ì´ë“œ ì „ìš© í‚¤ (í™˜ê²½ ë³€ìˆ˜ì—ë§Œ ì‚¬ìš©, í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œ ê¸ˆì§€)
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
```

### 2.2 API í‚¤ í™•ì¸ ë°©ë²•

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Settings** > **API**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ë‹¤ìŒ í‚¤ë“¤ì„ ë³µì‚¬í•©ë‹ˆë‹¤:
   - **Project URL**: `NEXT_PUBLIC_SUPABASE_URL`ì— ì‚¬ìš©
   - **anon public**: `NEXT_PUBLIC_SUPABASE_ANON_KEY`ì— ì‚¬ìš©
   - **service_role**: `SUPABASE_SERVICE_ROLE_KEY`ì— ì‚¬ìš© (âš ï¸ ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”)

### 2.3 í™˜ê²½ ë³€ìˆ˜ ì ìš©

`.env.local` íŒŒì¼ì„ ì €ì¥í•œ í›„ ê°œë°œ ì„œë²„ë¥¼ ì¬ì‹œì‘í•©ë‹ˆë‹¤:

```bash
npm run dev
```

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì ìš©

### 3.1 SQL Editorì—ì„œ ìŠ¤í‚¤ë§ˆ ì‹¤í–‰

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **SQL Editor**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. **New Query**ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
3. `supabase/schema.sql` íŒŒì¼ì˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.
4. **Run** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.

### 3.2 ìŠ¤í‚¤ë§ˆ í™•ì¸

ìŠ¤í‚¤ë§ˆê°€ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤:

1. **Table Editor**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ë‹¤ìŒ í…Œì´ë¸”ë“¤ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤:
   - `franchises`
   - `stores`
   - `users`
   - `product_categories`
   - `products`
   - `orders`
   - `order_items`
   - `notices`
   - `notice_reads`
   - `quality_checklists`
   - `quality_items`
   - `quality_records`
   - `quality_record_items`
   - `training_materials`
   - `payment_logs`

---

## 4. ì¸ì¦ ì„¤ì •

### 4.1 Supabase Auth ì„¤ì •

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Authentication** > **Providers**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. **Email** í”„ë¡œë°”ì´ë”ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.
3. í•„ìš”ì— ë”°ë¼ ë‹¤ìŒ ì„¤ì •ì„ ì¡°ì •í•©ë‹ˆë‹¤:
   - **Enable email confirmations**: ì´ë©”ì¼ í™•ì¸ í•„ìš” ì—¬ë¶€
   - **Secure email change**: ì´ë©”ì¼ ë³€ê²½ ì‹œ í™•ì¸ í•„ìš” ì—¬ë¶€

### 4.2 ì‚¬ìš©ì ë“±ë¡ í”Œë¡œìš°

Supabase AuthëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ì„ ì§€ì›í•©ë‹ˆë‹¤. 

**ì°¸ê³ **: í˜„ì¬ ìŠ¤í‚¤ë§ˆì—ì„œëŠ” `users` í…Œì´ë¸”ì— `password_hash` í•„ë“œê°€ ìˆì§€ë§Œ, Supabase Authë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì´ í•„ë“œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëŒ€ì‹  Supabase Authì˜ `auth.users` í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ê³ , `public.users` í…Œì´ë¸”ì€ ì¶”ê°€ ì •ë³´(role, status, franchise_id ë“±)ë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 4.3 ì‚¬ìš©ì ë“±ë¡ íŠ¸ë¦¬ê±° (ì„ íƒì‚¬í•­)

`auth.users`ì— ì‚¬ìš©ìê°€ ìƒì„±ë  ë•Œ ìë™ìœ¼ë¡œ `public.users` í…Œì´ë¸”ì— ë ˆì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” íŠ¸ë¦¬ê±°ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```sql
-- auth.usersì— ì‚¬ìš©ìê°€ ìƒì„±ë  ë•Œ public.usersì—ë„ ë ˆì½”ë“œ ìƒì„±
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.users (id, email, password_hash, role, status)
  VALUES (
    NEW.id,
    NEW.email,
    '', -- Supabase Authë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ password_hashëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    'STAFF', -- ê¸°ë³¸ ì—­í• 
    'PENDING' -- ê¸°ë³¸ ìƒíƒœ
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

---

## 5. RLS ì •ì±… ì„¤ì •

### 5.1 ê¸°ë³¸ RLS ì •ì±…

`supabase/schema.sql` íŒŒì¼ì— ê¸°ë³¸ RLS ì •ì±…ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í•„ìš”ì— ë”°ë¼ ì¶”ê°€ ì •ì±…ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 5.2 ì •ì±… í™•ì¸ ë° ìˆ˜ì •

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Authentication** > **Policies**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ê° í…Œì´ë¸”ë³„ë¡œ ì •ì±…ì„ í™•ì¸í•˜ê³  í•„ìš”ì— ë”°ë¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

### 5.3 ì£¼ìš” ì •ì±… ì˜ˆì‹œ

- **ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŒ**
- **OWNER/STAFFëŠ” ìì‹ ì˜ í”„ëœì°¨ì´ì¦ˆ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŒ**
- **ëª¨ë“  ì‚¬ìš©ìëŠ” í™œì„±í™”ëœ ìƒí’ˆì„ ë³¼ ìˆ˜ ìˆìŒ**
- **ADMINì€ ëª¨ë“  ìƒí’ˆì„ ë³¼ ìˆ˜ ìˆìŒ**
- **OWNER/STAFFëŠ” ìì‹ ì˜ ì£¼ë¬¸ì„ ë³¼ ìˆ˜ ìˆìŒ**

---

## 6. í…ŒìŠ¤íŠ¸

### 6.1 ì—°ê²° í…ŒìŠ¤íŠ¸

ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ë‹¤ìŒì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤:

```javascript
// í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ í…ŒìŠ¤íŠ¸
import { createClient } from '@/lib/supabase/client';

const supabase = createClient();
const { data, error } = await supabase.from('products').select('*').limit(1);
console.log('Products:', data);
```

### 6.2 ì¸ì¦ í…ŒìŠ¤íŠ¸

1. ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤.
2. ì¸ì¦ì´ ì„±ê³µí•˜ë©´ ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¿ í‚¤ê°€ ì„¤ì •ë©ë‹ˆë‹¤.
3. ë³´í˜¸ëœ ë¼ìš°íŠ¸(`/dashboard/*`, `/admin/*`)ì— ì ‘ê·¼í•˜ì—¬ ì¸ì¦ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

### 6.3 ê¶Œí•œ í…ŒìŠ¤íŠ¸

1. **OWNER/STAFF ì—­í• **ë¡œ ë¡œê·¸ì¸í•˜ì—¬ `/dashboard/*` ë¼ìš°íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
2. **ADMIN ì—­í• **ë¡œ ë¡œê·¸ì¸í•˜ì—¬ `/admin/*` ë¼ìš°íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
3. ê¶Œí•œì´ ì—†ëŠ” ì‚¬ìš©ìê°€ ì ‘ê·¼ì„ ì‹œë„í•˜ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

---

## 7. ì¶”ê°€ ì„¤ì •

### 7.1 Storage ì„¤ì • (ì´ë¯¸ì§€ ì—…ë¡œë“œìš©)

ìƒí’ˆ ì´ë¯¸ì§€ë‚˜ êµìœ¡ ìë£Œë¥¼ ì—…ë¡œë“œí•˜ë ¤ë©´ Storageë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Storage**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ìƒˆ ë²„í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤:
   - **Name**: `product-images` (ìƒí’ˆ ì´ë¯¸ì§€ìš©)
   - **Public bucket**: ì²´í¬ (ê³µê°œ ì ‘ê·¼ í—ˆìš©)
3. Storage ì •ì±…ì„ ì„¤ì •í•©ë‹ˆë‹¤.

### 7.2 ì‹¤ì‹œê°„ ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)

ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ë“±ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´ Realtimeì„ í™œì„±í™”í•©ë‹ˆë‹¤:

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Database** > **Replication**ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ í…Œì´ë¸”ì„ ì„ íƒí•©ë‹ˆë‹¤ (ì˜ˆ: `orders`).

---

## 8. ë¬¸ì œ í•´ê²°

### 8.1 ë¹Œë“œ íƒ€ì„ ì˜¤ë¥˜

Vercel ë“±ì—ì„œ ë¹Œë“œ ì‹œ Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì¸ì‹ë˜ì§€ ì•ŠëŠ” ê²½ìš°:

1. Vercel ëŒ€ì‹œë³´ë“œì—ì„œ **Settings** > **Environment Variables**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `SUPABASE_SERVICE_ROLE_KEY`

ë˜ëŠ” ë¯¼ê°í•œ ë¼ìš°íŠ¸ì— ë‹¤ìŒì„ ì¶”ê°€í•©ë‹ˆë‹¤:

```javascript
export const dynamic = "force-dynamic";
```

### 8.2 RLS ì •ì±… ì˜¤ë¥˜

RLS ì •ì±…ì´ ë„ˆë¬´ ì—„ê²©í•˜ì—¬ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ëŠ” ê²½ìš°:

1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Authentication** > **Policies**ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. í•´ë‹¹ í…Œì´ë¸”ì˜ ì •ì±…ì„ í™•ì¸í•˜ê³  í•„ìš”ì— ë”°ë¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
3. ê°œë°œ ì¤‘ì—ëŠ” ì„ì‹œë¡œ RLSë¥¼ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆì§€ë§Œ, í”„ë¡œë•ì…˜ì—ì„œëŠ” ë°˜ë“œì‹œ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.

### 8.3 ì¸ì¦ ì˜¤ë¥˜

ì¸ì¦ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°:

1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ ì¿ í‚¤ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
2. `middleware.ts`ì˜ ê²½ë¡œ ë§¤ì¹­ ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤.
3. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ **Authentication** > **Users**ì—ì„œ ì‚¬ìš©ìê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

---

## 9. ë‹¤ìŒ ë‹¨ê³„

- [ ] ì‚¬ìš©ì ë“±ë¡ API êµ¬í˜„
- [ ] ìƒí’ˆ ê´€ë¦¬ API êµ¬í˜„
- [ ] ì£¼ë¬¸ ê´€ë¦¬ API êµ¬í˜„
- [ ] íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„
- [ ] ì‹¤ì‹œê°„ ì•Œë¦¼ ê¸°ëŠ¥ êµ¬í˜„

---

## ì°¸ê³  ìë£Œ

- [Supabase ê³µì‹ ë¬¸ì„œ](https://supabase.com/docs)
- [Next.js + Supabase ê°€ì´ë“œ](https://supabase.com/docs/guides/getting-started/quickstarts/nextjs)
- [Supabase Auth ê°€ì´ë“œ](https://supabase.com/docs/guides/auth)
- [Row Level Security ê°€ì´ë“œ](https://supabase.com/docs/guides/auth/row-level-security)

